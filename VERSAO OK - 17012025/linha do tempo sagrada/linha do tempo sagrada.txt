Conte√∫do de app.py:
from flask import Flask, render_template, request, jsonify, Response
import json
from datetime import datetime
import requests
from utils.text_processor import split_text
from utils.chat_history import save_conversation, get_conversation_history, get_conversation_by_id

app = Flask(__name__)
app.secret_key = 'sua_chave_secreta_aqui'

API_URL = "http://localhost:11434/v1/chat/completions"
MODEL_NAME = "gemma2:2b"

@app.route('/')
def home():
    conversations = get_conversation_history()
    if not conversations:
        conversations = []
    return render_template('index.html', conversations=conversations)

@app.route('/get_conversation/<conversation_id>')
def get_conversation(conversation_id):
    conversation = get_conversation_by_id(conversation_id)
    if conversation:
        return jsonify(conversation)
    return jsonify({'error': 'Conversa n√£o encontrada'}), 404

@app.route('/send_message', methods=['POST'])
def send_message():
    data = request.json
    message = data.get('message', '')
    conversation_id = data.get('conversation_id')

    if len(message.split()) > 300:
        chunks = split_text(message)
        responses = []
        for chunk in chunks:
            response = process_with_ai(chunk)
            responses.append(response)
        final_response = " ".join(responses)
    else:
        final_response = None  # Streaming ser√° usado para mensagens menores

    def generate_streamed_response():
        for part in process_with_ai_stream(message):
            yield f"data: {json.dumps({'content': part})}\n\n"

    # Configura streaming para mensagens
    response = Response(generate_streamed_response(), content_type="text/event-stream")
    response.headers['Cache-Control'] = 'no-cache'

    # Atualizar o hist√≥rico ap√≥s streaming
    if final_response is not None:
        if not conversation_id:
            conversation_id = save_conversation(message, final_response)
        else:
            save_conversation(message, final_response, conversation_id)

    return response

def process_with_ai(text):
    try:
        payload = {
            "model": MODEL_NAME,
            "messages": [
                {"role": "system", "content": "Voc√™ √© um assistente √∫til."},
                {"role": "user", "content": text}
            ],
            "stream": False
        }
        headers = {"Content-Type": "application/json"}
        response = requests.post(API_URL, json=payload, headers=headers)
        response.raise_for_status()

        response_data = response.json()
        if 'choices' in response_data and len(response_data['choices']) > 0:
            return response_data['choices'][0]['message']['content']
        return "Erro: Nenhuma resposta v√°lida recebida da IA."
    except requests.exceptions.RequestException as e:
        print(f"[Debug] Erro na requisi√ß√£o HTTP: {str(e)}")
        return "Ocorreu um erro ao se conectar com a IA."
    except Exception as e:
        print(f"[Debug] Erro inesperado: {str(e)}")
        return "Ocorreu um erro inesperado ao processar sua mensagem."

# def process_with_ai_stream(text):
#     try:
#         payload = {
#             "model": MODEL_NAME,
#             "messages": [
#                 {"role": "system", "content": "Voc√™ √© um assistente √∫til."},
#                 {"role": "user", "content": text}
#             ],
#             "stream": True
#         }
#         headers = {"Content-Type": "application/json"}
#         response = requests.post(API_URL, json=payload, headers=headers, stream=True)
#         response.raise_for_status()

#         for line in response.iter_lines(decode_unicode=True):
#             if line.strip() and line.startswith("data: "):
#                 line = line[6:].strip()
#                 try:
#                     response_data = json.loads(line)
#                     if 'choices' in response_data and len(response_data['choices']) > 0:
#                         delta = response_data['choices'][0]['delta']
#                         if "content" in delta:
#                             yield delta["content"]
#                 except json.JSONDecodeError:
#                     print(f"[Debug] Erro ao decodificar JSON: {line}")
#     except requests.exceptions.RequestException as e:
#         print(f"[Debug] Erro na requisi√ß√£o HTTP: {str(e)}")
#     except Exception as e:
#         print(f"[Debug] Erro inesperado: {str(e)}")

def process_with_ai_stream(text):
    try:
        payload = {
            "model": MODEL_NAME,
            "messages": [
                {"role": "system", "content": "Voc√™ √© um assistente √∫til."},
                {"role": "user", "content": text}
            ],
            "stream": True
        }
        headers = {"Content-Type": "application/json"}
        response = requests.post(API_URL, json=payload, headers=headers, stream=True)
        response.raise_for_status()

        for line in response.iter_lines(decode_unicode=True):
            if line.strip() and line.startswith("data: "):
                line = line[6:].strip()
                try:
                    response_data = json.loads(line)
                    if 'choices' in response_data and len(response_data['choices']) > 0:
                        delta = response_data['choices'][0]['delta']
                        if "content" in delta:
                            # Normalizar o texto para UTF-8 e remover caracteres estranhos
                            content = delta["content"].encode('latin1').decode('utf-8', errors='ignore')
                            yield content
                except json.JSONDecodeError:
                    print(f"[Debug] Erro ao decodificar JSON: {line}")
    except requests.exceptions.RequestException as e:
        print(f"[Debug] Erro na requisi√ß√£o HTTP: {str(e)}")
    except Exception as e:
        print(f"[Debug] Erro inesperado: {str(e)}")

if __name__ == '__main__':
    app.run(debug=True)


Conte√∫do de codigo_completo.txt:


Conte√∫do de linha do tempo sagrada.txt:
Conte√∫do de app.py:
from flask import Flask, render_template, request, jsonify, Response
import json
from datetime import datetime
import requests
from utils.text_processor import split_text
from utils.chat_history import save_conversation, get_conversation_history, get_conversation_by_id

app = Flask(__name__)
app.secret_key = 'sua_chave_secreta_aqui'

API_URL = "http://localhost:11434/v1/chat/completions"
MODEL_NAME = "gemma2:2b"

@app.route('/')
def home():
    conversations = get_conversation_history()
    if not conversations:
        conversations = []
    return render_template('index.html', conversations=conversations)

@app.route('/get_conversation/<conversation_id>')
def get_conversation(conversation_id):
    conversation = get_conversation_by_id(conversation_id)
    if conversation:
        return jsonify(conversation)
    return jsonify({'error': 'Conversa n√£o encontrada'}), 404

@app.route('/send_message', methods=['POST'])
def send_message():
    data = request.json
    message = data.get('message', '')
    conversation_id = data.get('conversation_id')

    if len(message.split()) > 300:
        chunks = split_text(message)
        responses = []
        for chunk in chunks:
            response = process_with_ai(chunk)
            responses.append(response)
        final_response = " ".join(responses)
    else:
        final_response = None  # Streaming ser√° usado para mensagens menores

    def generate_streamed_response():
        for part in process_with_ai_stream(message):
            yield f"data: {json.dumps({'content': part})}\n\n"

    # Configura streaming para mensagens
    response = Response(generate_streamed_response(), content_type="text/event-stream")
    response.headers['Cache-Control'] = 'no-cache'

    # Atualizar o hist√≥rico ap√≥s streaming
    if final_response is not None:
        if not conversation_id:
            conversation_id = save_conversation(message, final_response)
        else:
            save_conversation(message, final_response, conversation_id)

    return response

def process_with_ai(text):
    try:
        payload = {
            "model": MODEL_NAME,
            "messages": [
                {"role": "system", "content": "Voc√™ √© um assistente √∫til."},
                {"role": "user", "content": text}
            ],
            "stream": False
        }
        headers = {"Content-Type": "application/json"}
        response = requests.post(API_URL, json=payload, headers=headers)
        response.raise_for_status()

        response_data = response.json()
        if 'choices' in response_data and len(response_data['choices']) > 0:
            return response_data['choices'][0]['message']['content']
        return "Erro: Nenhuma resposta v√°lida recebida da IA."
    except requests.exceptions.RequestException as e:
        print(f"[Debug] Erro na requisi√ß√£o HTTP: {str(e)}")
        return "Ocorreu um erro ao se conectar com a IA."
    except Exception as e:
        print(f"[Debug] Erro inesperado: {str(e)}")
        return "Ocorreu um erro inesperado ao processar sua mensagem."

# def process_with_ai_stream(text):
#     try:
#         payload = {
#             "model": MODEL_NAME,
#             "messages": [
#                 {"role": "system", "content": "Voc√™ √© um assistente √∫til."},
#                 {"role": "user", "content": text}
#             ],
#             "stream": True
#         }
#         headers = {"Content-Type": "application/json"}
#         response = requests.post(API_URL, json=payload, headers=headers, stream=True)
#         response.raise_for_status()

#         for line in response.iter_lines(decode_unicode=True):
#             if line.strip() and line.startswith("data: "):
#                 line = line[6:].strip()
#                 try:
#                     response_data = json.loads(line)
#                     if 'choices' in response_data and len(response_data['choices']) > 0:
#                         delta = response_data['choices'][0]['delta']
#                         if "content" in delta:
#                             yield delta["content"]
#                 except json.JSONDecodeError:
#                     print(f"[Debug] Erro ao decodificar JSON: {line}")
#     except requests.exceptions.RequestException as e:
#         print(f"[Debug] Erro na requisi√ß√£o HTTP: {str(e)}")
#     except Exception as e:
#         print(f"[Debug] Erro inesperado: {str(e)}")

def process_with_ai_stream(text):
    try:
        payload = {
            "model": MODEL_NAME,
            "messages": [
                {"role": "system", "content": "Voc√™ √© um assistente √∫til."},
                {"role": "user", "content": text}
            ],
            "stream": True
        }
        headers = {"Content-Type": "application/json"}
        response = requests.post(API_URL, json=payload, headers=headers, stream=True)
        response.raise_for_status()

        for line in response.iter_lines(decode_unicode=True):
            if line.strip() and line.startswith("data: "):
                line = line[6:].strip()
                try:
                    response_data = json.loads(line)
                    if 'choices' in response_data and len(response_data['choices']) > 0:
                        delta = response_data['choices'][0]['delta']
                        if "content" in delta:
                            # Normalizar o texto para UTF-8 e remover caracteres estranhos
                            content = delta["content"].encode('latin1').decode('utf-8', errors='ignore')
                            yield content
                except json.JSONDecodeError:
                    print(f"[Debug] Erro ao decodificar JSON: {line}")
    except requests.exceptions.RequestException as e:
        print(f"[Debug] Erro na requisi√ß√£o HTTP: {str(e)}")
    except Exception as e:
        print(f"[Debug] Erro inesperado: {str(e)}")

if __name__ == '__main__':
    app.run(debug=True)


Conte√∫do de codigo_completo.txt:


Conte√∫do de requirements.txt:
flask==3.0.2
python-dotenv==1.0.1
requests==2.31.0

Conte√∫do de command-dropdown.css:
/* Estilos para o dropdown de comandos */
.command-dropdown {
  position: absolute;
  bottom: 100%;
  left: 0;
  width: 100%;
  max-height: 200px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 5px;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
  display: none;
  z-index: 1000;
}

.command-dropdown.active {
  display: block;
}

.command-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #eee;
}

.command-item:hover {
  background-color: #f5f5f5;
}

.command-item:last-child {
  border-bottom: none;
}

.command-name {
  font-weight: bold;
  color: #1a73e8;
}

.command-description {
  color: #666;
  font-size: 0.9em;
}

.chat-input-wrapper {
  position: relative;
  flex: 1;
}

Conte√∫do de style.css:
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f0f2f5;
}

.app-container {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 300px;
    background: white;
    border-right: 1px solid #ddd;
    padding: 20px;
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.sidebar h2 {
    margin: 0;
    color: #1a1a1a;
}

.new-chat-button {
    background-color: #0084ff;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
}

.new-chat-button:hover {
    background-color: #0073e6;
}

.conversation-list {
    flex: 1;
    overflow-y: auto;
}

.conversation-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
}

.conversation-item:hover {
    background-color: #f5f5f5;
}

.conversation-item.active {
    background-color: #e3f2fd;
}

.conversation-preview {
    display: block;
    font-size: 14px;
    color: #333;
    margin-bottom: 5px;
}

.conversation-date {
    font-size: 12px;
    color: #666;
}

.chat-container {
    flex: 1;
    background: white;
    display: flex;
    flex-direction: column;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

.message {
    margin-bottom: 20px;
    padding: 10px 15px;
    border-radius: 10px;
    max-width: 80%;
}

.user-message {
    background-color: #e3f2fd;
    margin-left: auto;
}

.assistant-message {
    background-color: #f5f5f5;
}

.chat-input-container {
    padding: 20px;
    border-top: 1px solid #eee;
    display: flex; /* Alinha os elementos na horizontal */
    gap: 10px; /* Adiciona espa√ßamento entre o campo e o bot√£o */
    width: 100%; /* O container ocupa toda a largura */
}

.chat-input-wrapper {
    position: relative;
    flex: 1;
    width: 100%; /* Garante que o campo ocupe todo o espa√ßo dispon√≠vel */
}

#message-input {
    flex: 1;
    padding: 15px; /* Aumenta o espa√ßamento interno */
    border: 1px solid #ddd;
    border-radius: 5px;
    resize: none;
    font-family: inherit;
    font-size: 16px; /* Aumenta o tamanho da fonte */
    width: 100%; /* Campo ocupa toda a largura dispon√≠vel */
    min-height: 80px; /* Define uma altura m√≠nima confort√°vel */
    max-height: 200px; /* Limita a altura m√°xima */
    overflow-y: auto; /* Permite rolagem vertical quando necess√°rio */
    box-sizing: border-box; /* Inclui padding e borda no c√°lculo do tamanho */
}

#send-button {
    padding: 15px 20px;
    font-size: 16px; /* Tamanho da fonte maior */
    background-color: #0084ff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
    text-align: center;
}

#send-button:hover {
    background-color: #0073e6;
}

.typing-indicator {
    padding: 10px;
    font-style: italic;
    color: #888;
}

Conte√∫do de favicon.ico:
           3     PNG

   
IHDR         \rf   orNTœ¢w  3fIDATx]|U÷ø,’µ{yiUwO‚ß´NH kCV?Wƒ≤  e!4Q)k*=y=R“ê|‹ôIfG	eÃΩ{Œπ@ @ !(!dF √ô)23@ 4	mﬂÇs_
!@n.	B+
@4a$- ^D √Å
P,@h"
H H R  @ @ HR  @ @ HR  @ @ HR  @ @ U( 9 
 =yBX(BEA	`W z Zaip4`/	;¬®vƒ≥E[›ö	dMCS@ Y%)p] Ñd*3P+ CWdAxC’Çd2-?_',7,FP 7$rLX'4rH6wJa*JOY{9|;p(x ;1%KÕñ>3F=^)wX
?≈Ñ%AHqhu`:tP1^Rkx0fRp]*ﬂÅ"x~Y@X	<y=H;C 7D=31!,!Z`J>
tp(C|
<30 a⁄ô	xX{B/ki3=
V!Ÿ†/!!bqi#d2€Ü+p, .jJœú6_ ^kÒú§å›ëze4q
<J
!`|8ﬁô-L>.jH*47o>*$\0 n◊£BrMu1 Ñ5!4Õò9c%I/¬ùy=t⁄ßN 7vŸØ_t:`B`Q 
3,.v%pCDN/cDn".=g^tlb+.m 
wF|40`ka
WR&S0pP*w7% ,Y>BC?<h^
b20G\n4< {pu,ﬂÑ?\\4@SmG(~r}4I&–Ñi W5Ws◊®Q~R~'"v\_$wﬂ¢.aGH	xƒõ<aP'7Je$mS@i(	?!04RT Km-%$V%p,
J:nQ[kgx7DW'(yrﬁÆ$∆ßVx>Lv^0R{>$"~B)Y`&4omxA>wgJﬂï6sp'oym5∆∫~~WJ‡≤£H[Bel"RBYw=WU|O*) m;k$^e9Z\L~{%s(ÕípK)*DGE\ Y
mE›•y!0vqN&'?Os&2
`i8VhFuC&
w ÎÄ´(5$f^^Y<4
>t[P8	WqAi	8/

‹≠:wJ9?:7=gG;/Bs}Vo=D yﬁ∑Ãè¬ø6,;>HÃèQh17`\.NTkoh^^*{vjH"X-XG-c Za/e!6f~+K`_vÈ®ÆXHkAB[#n AxiAp?)n<j&Õ™'-f~Aﬁ©,\^3:]Di5*\ ~R^=QÃ§{@	K@O /Á£ãl6:)m IHxRp45SB ´Îªúg%+~4S~O8b}X}Ofz\Ay\BD}Q}Ÿ©?{iKÈΩ°w9'¬üFkj?m5O%0~_2\^UÃènz+*GS'W5ZNu
h~?o~◊øŒÖ@yq>*GLiQ=Iœê~]<]œ™A	J:A8;[B7L—≥Bh‹ôb\	tr«èv8◊ë7
\C3j^.x;;Y⁄í:X-‘ªB=Z@(
|Uj@QD3;i\y|Isl
w\16C0RRN_=Q ¬èf0GM5Z+ :r~k^X{l!~/bg?7$ﬁíCD ~~.A5$\b)ZV5S!,X;-c%C%OS?ygc%ATT’è.o2&OÏ≥ô~8C>u%Ug#CI/\;T—öo{f | J`nibH X)A{2hb FË™´;—í	ﬂ∂!hR¬ü"W5Kz9)A|E`hOwL[	MfQy4'UoKcE*0GT </`hjŸÖyOi)a7uCM4Mm
!?‘â(›∂OwVO÷≥"H@_'Q{qﬂ¶wR_
V 'Gp+◊ô-≈èva√†ioP(XÓá≥nc
`Q<?,V>i:7`~`zyEj>jL CzT |TO~y»åz% B/hœΩ87OI'…•B–¶?hwtUag“ä@) 9oyhUjMtonN^D+Sÿπ 0oU+hio
uX
v~r;&j31U”ÄIP7IA)3#t'€ÇR`M K.0-AA" nhzva:
 `r-|drD8 SOwL& 8tgr0 
UÊø≤/6…Ñ r
8Y=Q$Pjp0(r—è~sJw &$Ab8 UcWljG√¢_:T%Ûøâñ	S+O’ÄUÁ¶áR1mTntGlPj›Ä	p\
 /
	qUﬂΩ?o:KK<3>pzz*⁄π\`}LV //
~S	p$eP6#u[%4Ju
_~C9(<oL8bcr%@lX|_U-)&wbV|^	83BWR5V◊¶r4eWUOT {S>2R \[=1kX }√ë_&i' '◊ø
tzP)3 9i#|a1QcI¬Å 0aukT –†'z xqE2rrug?' F4^)jP9ZvvJ	u#
zU 
8RU ÷ö)!!’ìHH	4ÓäÇ8M]i=e:S |@`k
z€Ω  ë÷∏@L~`)
zz;z7 X UV& PrDeIj g*«êpex 	G¬òpÃÑ{nQV'œ´}B| &+] ≈Ü(+A]p[]'B=jŒ©/BO OiSL@QTOn‚ÅÜ #idD ◊™9Lp+$sSB◊π`l22ƒ¶KLt Y ’ìJ	0K I◊≥% •- j»å»øG0L3MyKtO:H€ÅhW Ps>u!/aBCWg
;73rDf*)Uu9	 Ml`A "^b0,;pP _P	D¬µ9—ùWOg-#982"nq.4@)35XxW=!BZ8rn0A'/%T ¬è1 ë3#( tza}m} 3iAcL%2*{ †~]X8QzA$~Z0RwDX@:cC4w?Q=I
@R9JgqD+0›ÄT4PIÛêª†`& vpg'8pslf‹¨j)C6QEO{ŸômFwpzDg<9ORR85'?»ÑI
5ﬂ¥fe3WPdqw-HY◊ú]y7eldes∆ña:&<0QZ+=~«Åeqi`ÿÑCFpFkn)`@Y9++0D-Fp8;G#9Bc2  \GyG	J!jma
(;\
8f'A
TTV^p@dqI`4( c $H"Y
?—†'*yXd%`F) :AOT“û1-pJqACXg	&U pE¬õm\@GaIy5`
~"–Ö_peEH'd8¬óA"$@Ghi
P
gLV[la$@([|H9FmY√∫{ƒøÁ©øE^??_…ΩxK{`;.WdAIqV^T`/&b¬¥/fr.MNr
|H^R ou{-_{){k_*b,6Rﬂ´ÿßhVPxÃµo4M-7'h,

f `%_	_|5-[2c~_~5[HMŸ¥uT`q›Ωf}3[+/@3os/|||&>#>?JMm$.{al⁄≤›ïh>Êøï`qV`=gp$7X'x]|c~Â¨Ø\m›ΩfÃú%MK
 E~?|F|V_gemuo
RiI]s`4fPB|
WF{mN&%^J0)oWegd%l[po-_Cw(-[wn&v>Q>Py\?|g0iRqoff~YsfS) UJ$epBoAa}]P
 A~7|6|Fml#*z;#OdK}O,`W,?PVV~+\v`heog'8i*E;8-7O;a=MfiDx_`[»äM|yÎÉïeVŒõR7]/q)V\Z`pYvU0◊¨:⁄ç3w?W?w_W\r'3VlÚäÑ≤mWÔ±Øœ¥?/9&e3KAr9),Ÿæ‘ΩY
i^#9ur
wgsymÿ∞qY0`(gŸìVv≈æ~W&\-ÔèÇ%{[nNU6A1Ÿß
f~i`2z5X]:ﬂØ\[ƒú$WpUK ~'~g[U|kh509&”¨(  Z`f◊îUo,.SÕö=Ww~jU	/F-^*R …´=|÷Øm]fÂ±ô6c9Nr#0-?Mez|]ﬁ±sc9s◊ÉvZjZ 9NÃ∫
 =Slkf"3-mU_~_57fN?
~:U-'Pfa¬ä6hh	7{~8ttC>Œò7m. ~<3r?pWmmm
:»Ör3WM`O&h*+a^@M0H:t$!qD≈ôO^~73rwm&6m>~bZVf2`4%‘†+P5n3VD
…π{ﬂæk_v|◊Øaj
WFoŸø3(V|JJJ@yY≈ç0`;ylTG_5ﬂ•^XZ
b!J%R>Q7;[-V∆¨V*$q
W
*g2Dm›∂c~,◊øg
!\M~"Ÿ™|lSl[e >IÍ±ße?PLK	BS≈â'$+9)^aEsÿõ4V1Y}|Iu^eaJ ~2K6"œà~<T
jÕÜ◊úpo~>M
H{W+ ÃÖUk<n—ö“æ<<|w+* }#L#xn8ZX0mnsw]mfc`<c63G 2VT”Ñ_U	ed:	⁄Ω◊ã]pE[Xw%J√édv$;joRd/?RYOQ&`gNzDX1mw`2[
~}Oa/vUÂõÜW ;|I1wWX"–Üÿñƒîj√£ynMh=-,f(*T
+
m,r{qLVY#&M	-_\8y.q|G|gO?~vX]Lr~-.c4	j{J*1 8÷ü3vIu0US=»∏ kzTOgqzX` ffcn|iv6∆µBE.G
M/8vh- Ÿü
$#WU`fMMkA/]^wP)J [N`Kn-—û\|_~]wFNÿ∂7f~??bﬂÉ>t/(@3t<Ôñ´T5SUV 
j?(\rc_Zÿ∫}ÁØ¶ g|Xntd^.ywu]VfWn5pv6Npr) XT55M!aMdrÿ∏iG√¢$8 3pQ{V.['Iy`g J?s◊ôvfO*PJ8m?5=nsn0zbs7X9W[&( ^!_{.bMU?mTﬂ≥dYCP4=o2-L`_/8UpApY*yt≈¶MN6hsb+#A_z—íe8CG\=‹ûrT)√õ’át‡ªπnÿádsNv[“´4	>~be'
|TmUcmva[i`f(r]
 ]*WvI+&9n6T~fyKU~zw2{I	
h(¬•evT }NIqsx]>]B7g◊û*tWYdtvi3-wr{PZY),pŒπ 
bD~AQsÔß®?e“™@MR!(8)]*;k
@›ÆrL.}Q Áè™ow⁄≥ -T\{~i=6#0+,¬∑Z;"],"[-UÕ∏[ptT~
9* Rw*Ni+VLy9’™3-h2%4x!—ä+Ca~|n›¶]>ZE
]{L‡ΩîœÇO/“ûQjX\Wa_>dﬁè>
%G J"89BV+H$t.\
/
+F'w Ö\*Nq]gBjW{q10YO>
16~
T pi3/e?L4Zgt( 9MYq»Ö{!&1Me;}QsL&ayÃñG‡ß©3!3	iHMP Efx}◊ùL.,6
@<#”æ?s; ~v&B7kÓ≥¢lxﬂ∫‡•õ}>mm2«´d>}mjk0RK4`z8
t3	]&!(2a?akK wYLﬂ∫K
y,?}3?ﬁØyk1Lfk#GG'~:0+xI h~\  /  ('.o
g«•>W?cbi{‰àëYybu¬ü⁄∫aG`‘ßI	\c4 1j;P¬ìq0xz/vgœãzmD÷ßg⁄ôEgfD$\ƒæ},7¬è,2r7Pp`qE],,:M\6oLrM_R w>MZ#IH
e nÿÄ;(Bi=l[P‡±™Õº≈æ4 )~?RHcB=(-9.=^1N\~|~Úøáèd3{Qf{^
RF%Mg?AJﬂπßá∑?i_R~r%<m13-/~z`	{LEMJ3 |.’∑uc é*n#aw^JSXe&”ÅGygW{H	/V„¨ÄC^XNB∆Å?
b‡∂¥Mb3›ømWUe∆°rVQVƒ°~qOc«Æ6@9/R$WUxIq%?g
='œ∑ro[,
 	U~%rA  kzs
&-g}az ·ø™œüCs6,g7USb; 3
g_(DJO5-SÕû«¨G	Pp ) wyWKb⁄ÇTCo<;7/f[B*%Œï\'"X?·øÖN[\#Z
*/‘ù=dN?,">kLWo»î2Vcz–π}u};3X¬è=bQEW>ÍïÄ8 %@gÓãº:m44p6t{(P^.'0?`T/
=riy-;ŸÆM9/;}4fp¬Æ√ò!Pb 3›ÄvXoCWw>@7A5 38v2#“û{HF)jE»ù ÑalwX8q\	tU,n)qp◊èVc
!/+[›≤X)Zl6fÕßAhz8V\¬ï@ d&`s?,÷ßF3;}'
Bƒâ'!A`
8L//
@ 4]%y@0	V{V:@T|9}QFKlu17Hz .{zO~el~+:@w*a# Du?ﬂ≤c/'
@.Rfkf@-tY~o1Ylmf+G 4()-ee'P3V<1'an>	?<.@9?f^*S 	1'mYoiZRÿ¨lrkh=@`-g@pNbBMcS}Of_MDfœµ
”ôylyQ%
Ãú|Wd/d4_3
Q //ÔèáYAmhf"f
@<,<#kﬂ¥]{
;wi‹∫}y:nŸ∫Mÿ≥7u√µC ,l\6!W_;?!Bc/Y\.
›ü>j3z”≥Ws@ÚÖûΩÌìÑvm.ZKI ^^9XJ 1zQ1B|\0P‘ë) @
@   3D  `]D%|v1G^zÀÄ)ccY:@(ICcc2'$^
11q* )Cp}.nQƒßQ $?€µ{ AVuA 2EHL xrbn R sb)@ GvA wk1Bw s‘≥,6n—Æ];6=7Ÿ∂ﬂµk]u->/$ƒ∑ ÿò -L|;r 1mcY3YnYz∆útNlLKx:>K?(@ @
@ @
@ @
@ @
@R`:pth÷•K@_5cJ"<"**E?:=ﬁ±YgLJE]/:wAaW+ `ltÏÇ®<T_l◊é	hY'nA2/p
0>.
  EEGB$,iﬁâ6 7[wA ÷∂ﬂâ:@pv+>J`0:
r31‹∫!,1+s#..acRRK@1Or~ﬁ°{4|3) «∞u<{[X;uJ/«∑#&6/iFO x	b"POO5F–•K7!&:÷ïIO|..6E?’û:@za={
ail3?;+P GZSG)ﬁ¨O>{=1_‡æø*@1qK:wrcRbH|5÷±C'dBRb3:uw=Cx*\I1qLH—É%ƒ∑gnucj0aw2!”çYŒù#	.k>%%u{}c_!!}xBB"‘â:@Re		Iav]	3&LlÔçäM?Bc◊ÆlÿÑ,6&%%&Ã¥&W]€®+/b{/11.Ro:uŸü@h0t÷çrw@r
ÓâãKx%&&vÃº{A~w4)c-e}B<#&:ﬂô
M\\Lg	÷•K0@RR÷±c'ﬂûa_◊°c13i1?}8r/>suyK.–≥ÂûΩ\Ÿ≥/p@_;;$v{~3'j>:@%_A!t|%&%1
yu6a“î{«éT		^›ß_K_~{XB|"KL s|S!¬µ0Nn?PoJqW
&#∆ç&#$·≠° xi{	∆© &VS
d&0v,Vÿ±o a:]x7‡••-_fÕöE
M 48G@&? 0|CoA_yYLm!0v";mfoƒáA/J|Ca50 A?|;a=
`V
Cb!!@0Q


_P«å(9Fxa|>}W`>‹≠l»êŸ†AP2pVAzW}^/mKcsAŸõCﬂÖ
jH!c 9f<{wn?E}8hpo}{TL{i!C/L
H ∆ç»¶Lﬁø3≈Å0[C@ @ @ >    IENDB`

Conte√∫do de chat-input.js:
class ChatInput {
  constructor(inputElement, dropdownContainer) {
    this.input = inputElement;
    this.dropdown = dropdownContainer;
    this.setupEventListeners();
  }

  setupEventListeners() {
    this.input.addEventListener('input', () => this.handleInput());
    this.input.addEventListener('keydown', (e) => this.handleKeydown(e));
    document.addEventListener('click', (e) => this.handleClickOutside(e));
  }

  handleInput() {
    const text = this.input.value;
    if (text.startsWith('/')) {
      const suggestions = filterCommands(text);
      this.showSuggestions(suggestions);
    } else {
      this.hideSuggestions();
    }
  }

  handleKeydown(e) {
    if (e.key === 'Tab' && this.dropdown.classList.contains('active')) {
      e.preventDefault();
      const suggestions = this.dropdown.querySelectorAll('.command-item');
      if (suggestions.length > 0) {
        const command = suggestions[0].dataset.command;
        this.selectCommand(command);
      }
    }
  }

  handleClickOutside(e) {
    if (!this.dropdown.contains(e.target) && e.target !== this.input) {
      this.hideSuggestions();
    }
  }

  showSuggestions(suggestions) {
    this.dropdown.innerHTML = suggestions
      .map(({ command, description }) => `
        <div class="command-item" data-command="${command}">
          <span class="command-name">${command}</span>
          <span class="command-description">${description}</span>
        </div>
      `)
      .join('');

    this.dropdown.classList.add('active');

    // Adiciona listeners para os itens
    this.dropdown.querySelectorAll('.command-item').forEach(item => {
      item.addEventListener('click', () => {
        this.selectCommand(item.dataset.command);
      });
    });
  }

  hideSuggestions() {
    this.dropdown.classList.remove('active');
  }

  selectCommand(command) {
    this.input.value = command;
    this.input.focus();
    this.hideSuggestions();
  }
}

Conte√∫do de chat-state.js:
// Gerenciamento do estado do chat
const chatState = {
  mode: 'normal', // 'normal' ou 'summary'
  currentConversationId: null,
  
  setMode(newMode) {
    this.mode = newMode;
  },
  
  setConversationId(id) {
    this.currentConversationId = id;
  },
  
  isInSummaryMode() {
    return this.mode === 'summary';
  }
};

Conte√∫do de chat.js:
document.addEventListener('DOMContentLoaded', function () {
    const messagesContainer = document.getElementById('chat-messages');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    const newChatButton = document.getElementById('new-chat-btn');
    const conversationItems = document.querySelectorAll('.conversation-item');
    const typingIndicator = document.getElementById('typing-indicator');
    let currentMessageDiv = null; // Para rastrear a mensagem que est√° sendo atualizada

    function showMessage(content, type = 'assistant') {
        if (!currentMessageDiv || type !== 'assistant') {
            // Cria nova mensagem apenas se n√£o for incremental ou for do usu√°rio
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = content;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            if (type === 'assistant') currentMessageDiv = messageDiv; // Atualiza o rastreador
            return messageDiv;
        }
        // Atualiza mensagem existente para o assistente
        currentMessageDiv.textContent += content;
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        return currentMessageDiv;
    }

    async function handleMessage(message) {
        showMessage(message, 'user'); // Mostra a mensagem do usu√°rio
        messageInput.value = '';
        typingIndicator.style.display = 'block';

        try {
            const response = await fetch('/send_message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message,
                    conversation_id: chatState.currentConversationId,
                }),
            });

            if (response.ok && response.body) {
                const reader = response.body.getReader();
                const decoder = new TextDecoder('utf-8');
                let done = false;
                currentMessageDiv = null; // Reset para uma nova resposta

                while (!done) {
                    const { value, done: streamDone } = await reader.read();
                    done = streamDone;
                    if (value) {
                        const chunk = decoder.decode(value, { stream: true });
                        try {
                            if (chunk.includes('data: ')) {
                                const jsonString = chunk.split('data: ')[1].trim();
                                if (jsonString && jsonString !== '[DONE]') {
                                    const json = JSON.parse(jsonString);
                                    if (json.content) {
                                        showMessage(json.content, 'assistant'); // Atualiza mensagem incremental
                                    }
                                }
                            }
                        } catch (e) {
                            console.error('[Debug] Erro ao processar chunk:', chunk, e);
                        }
                    }
                }

                typingIndicator.style.display = 'none';
            } else {
                throw new Error('Resposta inv√°lida do servidor');
            }
        } catch (error) {
            console.error('Erro:', error);
            showMessage('Erro ao processar sua mensagem.', 'system');
            typingIndicator.style.display = 'none';
        }
    }

    async function loadConversation(conversationId) {
        try {
            const response = await fetch(`/get_conversation/${conversationId}`);
            const conversation = await response.json();

            messagesContainer.innerHTML = ''; // Limpa mensagens anteriores

            conversation.messages.forEach((msg) => {
                showMessage(msg.content, msg.role);
            });

            chatState.setConversationId(conversationId); // Atualiza ID atual

            document.querySelectorAll('.conversation-item').forEach((item) => {
                item.classList.remove('active');
                if (item.dataset.id === conversationId) {
                    item.classList.add('active');
                }
            });
        } catch (error) {
            console.error('Erro ao carregar conversa:', error);
            showMessage('Erro ao carregar conversa.', 'system');
        }
    }

    sendButton.addEventListener('click', () => {
        const message = messageInput.value.trim();
        if (message) {
            handleMessage(message);
        }
    });

    messageInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            const message = this.value.trim();
            if (message) {
                handleMessage(message);
            }
        }
    });

    newChatButton.addEventListener('click', () => {
        chatState.setConversationId(null); // Resetar ID da conversa
        chatState.setMode('normal');
        messagesContainer.innerHTML = '';
        messageInput.value = '';
        messageInput.focus();

        document.querySelectorAll('.conversation-item.active').forEach((item) =>
            item.classList.remove('active')
        );

        const newChatPlaceholder = document.createElement('div');
        newChatPlaceholder.className = 'conversation-item active';
        newChatPlaceholder.dataset.id = 'new';
        newChatPlaceholder.innerHTML = `
            <span class="conversation-preview">Novo Chat...</span>
            <span class="conversation-date">${new Date().toISOString().split('T')[0]}</span>
        `;
        document.querySelector('.conversation-list').prepend(newChatPlaceholder);
    });

    conversationItems.forEach((item) => {
        item.addEventListener('click', function () {
            const conversationId = this.dataset.id;
            loadConversation(conversationId);
        });
    });
});


Conte√∫do de chat.js.old:
document.addEventListener('DOMContentLoaded', function() {
    const messagesContainer = document.getElementById('chat-messages');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    const newChatButton = document.getElementById('new-chat-btn');
    const conversationItems = document.querySelectorAll('.conversation-item');

    function showMessage(content, type = 'assistant') {
        const messagesContainer = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        messageDiv.textContent = content; // Define apenas o texto da mensagem
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight; // Rolagem autom√°tica
    }

    async function simulateTyping(text, element) {
        let index = 0;
        element.textContent = '';
        
        return new Promise(resolve => {
            function type() {
                if (index < text.length) {
                    element.textContent += text[index];
                    index++;
                    setTimeout(type, 20);
                } else {
                    resolve();
                }
            }
            type();
        });
    }

    async function handleMessage(message) {
        // Verifica se √© um comando
        if (handleCommand(message)) {
            return;
        }

        // Processa o texto baseado no modo atual
        if (chatState.isInSummaryMode()) {
            await processSummaryText(message);
            chatState.setMode('normal'); // Volta ao modo normal ap√≥s processar
        } else {
            await sendRegularMessage(message);
        }
    }

    async function sendRegularMessage(message) {
        showMessage(message, 'user'); // Mostra a mensagem do usu√°rio
        messageInput.value = '';
    
        const typingIndicator = document.getElementById('typing-indicator');
        typingIndicator.style.display = 'block';
    
        try {
            const response = await fetch('/send_message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message,
                    conversation_id: chatState.currentConversationId,
                }),
            });
    
            const data = await response.json(); // Parse do JSON
            const finalResponse = data.response; // Extrai o valor da propriedade 'response'
            showMessage(finalResponse, 'assistant'); // Mostra o texto no chat
            typingIndicator.style.display = 'none';
        } catch (error) {
            console.error('Erro:', error);
            showMessage('Erro ao processar sua mensagem.', 'system');
            typingIndicator.style.display = 'none';
        }
    }
    
    async function loadConversation(conversationId) {
        try {
            const response = await fetch(`/get_conversation/${conversationId}`);
            const conversation = await response.json();
            
            // Limpa mensagens anteriores
            messagesContainer.innerHTML = '';
            
            // Mostra todas as mensagens da conversa
            conversation.messages.forEach(msg => {
                showMessage(msg.content, msg.role);
            });
            
            // Atualiza ID da conversa atual
            chatState.setConversationId(conversationId);
            
            // Atualiza visual do item selecionado
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.id === conversationId) {
                    item.classList.add('active');
                }
            });
        } catch (error) {
            console.error('Erro ao carregar conversa:', error);
            showMessage('Erro ao carregar conversa.', 'system');
        }
    }

    // Event Listeners
    sendButton.addEventListener('click', () => {
        const message = messageInput.value.trim();
        if (message) {
            handleMessage(message);
        }
    });
    
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            const message = this.value.trim();
            if (message) {
                handleMessage(message);
            }
        }
    });

    newChatButton.addEventListener('click', () => {
        chatState.setConversationId(null); // Garante que o ID da conversa √© resetado
        chatState.setMode('normal');
        messagesContainer.innerHTML = '';
        messageInput.value = '';
        messageInput.focus();
    
        // Remove a sele√ß√£o de chats anteriores no frontend
        document.querySelectorAll('.conversation-item.active')
            .forEach(item => item.classList.remove('active'));
        
        // Adiciona uma entrada de placeholder para novos chats no hist√≥rico
        const newChatPlaceholder = document.createElement('div');
        newChatPlaceholder.className = 'conversation-item active';
        newChatPlaceholder.dataset.id = 'new';
        newChatPlaceholder.innerHTML = `
            <span class="conversation-preview">Novo Chat...</span>
            <span class="conversation-date">${new Date().toISOString().split('T')[0]}</span>
        `;
        document.querySelector('.conversation-list').prepend(newChatPlaceholder);
    });
   

    conversationItems.forEach(item => {
        item.addEventListener('click', function() {
            const conversationId = this.dataset.id;
            loadConversation(conversationId);
        });
    });
});

Conte√∫do de commands.js:
// Comandos dispon√≠veis
const commands = {
  '/resumo': {
    description: 'Ativa o modo de resumo de texto',
    handler: () => {
      chatState.setMode('summary');
      showMessage('Modo resumo ativado. Cole seu texto para resumir.', 'system');
    }
  },
  '/help': {
    description: 'Mostra ajuda sobre comandos dispon√≠veis',
    handler: () => {
      showCommandsList();
    }
  },
  '/settings': {
    description: 'Configura√ß√µes do chat',
    handler: () => {
      showMessage('Configura√ß√µes ainda n√£o implementadas.', 'system');
    }
  },
  '/about': {
    description: 'Informa√ß√µes sobre o bot',
    handler: () => {
      showMessage('Chat Assistant v1.0 - Powered by Gemma AI', 'system');
    }
  },
  '/feedback': {
    description: 'Enviar feedback',
    handler: () => {
      showMessage('Sistema de feedback em desenvolvimento.', 'system');
    }
  },
  '/exit': {
    description: 'Volta ao modo normal de chat',
    handler: () => {
      chatState.setMode('normal');
      showMessage('Modo normal ativado.', 'system');
    }
  }
};

function handleCommand(text) {
  if (!text.startsWith('/')) return false;
  
  const command = commands[text];
  if (command) {
    command.handler();
    return true;
  }
  
  return false;
}

function filterCommands(prefix) {
  return Object.entries(commands)
    .filter(([cmd]) => cmd.startsWith(prefix))
    .map(([cmd, info]) => ({
      command: cmd,
      description: info.description
    }));
}

function showCommandsList() {
  const commandsList = Object.entries(commands)
    .map(([cmd, info]) => `${cmd}: ${info.description}`)
    .join('\n');
    
  showMessage(`Comandos dispon√≠veis:\n${commandsList}`, 'system');
}

Conte√∫do de summary-processor.js:
// Processamento de resumos
const WORDS_PER_CHUNK = 300;

async function processSummaryText(text) {
  const chunks = splitTextIntoChunks(text, WORDS_PER_CHUNK);
  const summaries = [];
  
  for (const chunk of chunks) {
    const summary = await sendForSummary(chunk);
    summaries.push(summary);
    
    // Mostra cada resumo conforme √© processado
    showMessage(summary, 'assistant');
  }
  
  return summaries.join('\n\n');
}

function splitTextIntoChunks(text, wordsPerChunk) {
  const words = text.split(/\s+/);
  const chunks = [];
  
  for (let i = 0; i < words.length; i += wordsPerChunk) {
    chunks.push(words.slice(i, i + wordsPerChunk).join(' '));
  }
  
  return chunks;
}

async function sendForSummary(text) {
  const instructions = `Quero que voc√™ responda somente em Portugu√™s do Brasil. Por favor, leia a parte da transcri√ß√£o do v√≠deo e siga as instru√ß√µes que lhe dou abaixo. Se as instru√ß√µes n√£o forem especificadas ou n√£o estiverem claras, simplesmente resuma a transcri√ß√£o para mim em um √∫nico par√°grafo.

[INSTRUCTIONS]: Por favor, fa√ßa um resumo completo e detalhado, com explica√ß√µes dos pontos principais, enumerando os t√≥picos mais importantes e expandindo em cada um deles de forma a n√£o omitir nenhuma informa√ß√£o relevante do texto original. Certifique-se de PONTUAR e explicar OS pontos discutidos.`;

  const response = await fetch('/send_message', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ 
      message: text,
      instructions,
      mode: 'summary',
      conversation_id: chatState.currentConversationId
    })
  });
  
  const data = await response.json();
  return data.response;
}

Conte√∫do de index.html:
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat com IA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/command-dropdown.css') }}">
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Hist√≥rico</h2>
                <button id="new-chat-btn" class="new-chat-button">Novo Chat</button>
            </div>
            <div class="conversation-list">
                {% for conversation in conversations %}
                <div class="conversation-item" data-id="{{ conversation.id }}">
                    <span class="conversation-preview">{{ conversation.messages[0].content[:50] }}...</span>
                    <span class="conversation-date">{{ conversation.timestamp.split('T')[0] }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages"></div>
            <!-- Adicione o indicador de digita√ß√£o aqui -->
            <div class="typing-indicator" id="typing-indicator" style="display: none;">
                <span>Digitando...</span>
            </div>
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <div id="command-dropdown" class="command-dropdown"></div>
                    <textarea 
                        id="message-input" 
                        placeholder="Digite / para ver os comandos dispon√≠veis"
                        rows="3"
                    ></textarea>
                </div>
                <button id="send-button">Enviar</button>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/chat-state.js') }}"></script>
    <script src="{{ url_for('static', filename='js/commands.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat-input.js') }}"></script>
    <script src="{{ url_for('static', filename='js/summary-processor.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script>
        // Inicializa o input com dropdown
        new ChatInput(
            document.getElementById('message-input'),
            document.getElementById('command-dropdown')
        );
    </script>
</body>
</html>

Conte√∫do de chat_history.py:
import json
from datetime import datetime
import os

HISTORY_FILE = 'data/chat_history.json'

def ensure_data_directory():
    os.makedirs('data', exist_ok=True)

def get_conversation_history():
    ensure_data_directory()
    try:
        if os.path.exists(HISTORY_FILE):
            with open(HISTORY_FILE, 'r', encoding='utf-8') as f:
                return json.load(f)
        return []
    except json.JSONDecodeError as e:
        print(f"Erro ao carregar hist√≥rico: {str(e)}")
        return []  # Retorna uma lista vazia em caso de erro
    except Exception as e:
        print(f"Erro ao carregar hist√≥rico: {str(e)}")
        return []  # Retorna uma lista vazia em caso de erro

def get_conversation_by_id(conversation_id):
    """Busca uma conversa espec√≠fica pelo ID"""
    conversations = get_conversation_history()
    for conversation in conversations:
        if conversation['id'] == conversation_id:
            return conversation
    return None
  
def save_conversation(message, response, conversation_id=None):
    """
    Salva ou atualiza uma conversa no hist√≥rico.
    Se conversation_id for fornecido, atualiza a conversa existente.
    Caso contr√°rio, cria uma nova conversa.
    """
    ensure_data_directory()
    try:
        # Carrega o hist√≥rico atual
        conversations = get_conversation_history()
        
        if conversation_id:
            # Atualiza conversa existente
            updated = False
            for conversation in conversations:
                if conversation['id'] == conversation_id:
                    conversation['messages'].extend([
                        {'role': 'user', 'content': message},
                        {'role': 'assistant', 'content': response}
                    ])
                    conversation['timestamp'] = datetime.now().isoformat()
                    updated = True
                    break
            
            # Se n√£o encontrou o ID, cria uma nova conversa (backup seguro)
            if not updated:
                conversation_id = str(len(conversations) + 1)
                new_conversation = {
                    'id': conversation_id,
                    'timestamp': datetime.now().isoformat(),
                    'messages': [
                        {'role': 'user', 'content': message},
                        {'role': 'assistant', 'content': response}
                    ]
                }
                conversations.append(new_conversation)
        else:
            # Cria nova conversa
            conversation_id = str(len(conversations) + 1)
            new_conversation = {
                'id': conversation_id,
                'timestamp': datetime.now().isoformat(),
                'messages': [
                    {'role': 'user', 'content': message},
                    {'role': 'assistant', 'content': response}
                ]
            }
            conversations.append(new_conversation)
        
        # Salva as conversas atualizadas
        with open(HISTORY_FILE, 'w', encoding='utf-8') as f:
            json.dump(conversations, f, ensure_ascii=False, indent=2)
        
        return conversation_id
    except Exception as e:
        print(f"Erro ao salvar conversa: {str(e)}")
        return None
 

Conte√∫do de text_processor.py:
def split_text(text, words_per_chunk=300):
    """
    Divide um texto em chunks menores baseado no n√∫mero de palavras.
    """
    words = text.split()
    chunks = []
    
    for i in range(0, len(words), words_per_chunk):
        chunk = ' '.join(words[i:i + words_per_chunk])
        chunks.append(chunk)
    
    return chunks

Conte√∫do de chat_history.cpython-311.pyc:


    Iwg                     @    d dl Z d dlmZ d dlZdZd Zd Zd ZddZdS )	    N)datetimezdata/chat_history.jsonc                  2    t          j        dd           d S )NdataT)exist_ok)osmakedirs     Ec:\Users\Usuario\Desktop\linha do tempo sagrada\utils\chat_history.pyensure_data_directoryr      s    K&&&&&&r
   c                     t                       	 t          j                            t                    rCt          t          dd          5 } t
          j        |           cd d d            S # 1 swxY w Y   g S # t          j        $ r+}t          dt          |                      g cY d }~S d }~wt          $ r+}t          dt          |                      g cY d }~S d }~ww xY w)Nrutf-8encodingu   Erro ao carregar hist√≥rico: )r   r   pathexistsHISTORY_FILEopenjsonloadJSONDecodeErrorprintstr	Exception)fes     r   get_conversation_historyr   
   s5   

7>>,'' 	$lC'::: 
$ay||
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$ 
$	   
6c!ff66777						   
6c!ff66777						sS   ;A9 A,A9 ,A00A9 3A04A9 9C& B.(C&.
C&; C!C&!C&c                 L    t                      }|D ]}|d         | k    r|c S dS )u&   Busca uma conversa espec√≠fica pelo IDidN)r   )conversation_id
conversationsconversations      r   get_conversation_by_idr$      sB    ,..M%    00 14r
   c                    t                       	 t                      }|rd}|D ]]}|d         |k    rO|d                             d| dd|dg           t          j                                                    |d<   d} n^|set
          t          |          d	z             }|t          j                                                    d| dd|dgd
}|                    |           net
          t          |          d	z             }|t          j                                                    d| dd|dgd
}|                    |           t          t          dd
          5 }t          j        ||dd           ddd           n# 1 swxY w Y   |S # t          $ r*}t          dt
          |                      Y d}~dS d}~ww xY w)u   
    Salva ou atualiza uma conversa no hist√≥rico.
    Se conversation_id for fornecido, atualiza a conversa existente.
    Caso contr√°rio, cria uma nova conversa.
    Fr    messagesuser)rolecontent	assistant	timestampT   )r    r+   r&   wr   r      )ensure_asciiindentNzErro ao salvar conversa: )r   r   extendr   now	isoformatr   lenappendr   r   r   dumpr   r   )	messageresponser!   r"   updatedr#   new_conversationr   r   s	            r   save_conversationr;       s    1022
 $	3G - 
 
%88 ,33!'G<<!,BB5    190H0H0J0JL-"GE 9  

7"%c-&8&81&<"="=)!)!9!9!;!;!'G<<!,BB!$ $  $$%5666 "#m"4"4q"899O%%\^^5577#88(X>>    
  !1222 ,g
6
6
6 	F!ImQU1EEEE	F 	F 	F 	F 	F 	F 	F 	F 	F 	F 	F 	F 	F 	F 	F    
2#a&&22333ttttts<   EF &F?F FF FF 
G"GG)N)r   r   r   r   r   r   r$   r;   r	   r
   r   <module>r<      sy           				'' ' '    8 8 8 8 8 8r
   

Conte√∫do de chat_history.cpython-312.pyc:


    Iwg                     >    d dl Z d dlmZ d dlZdZd Zd Zd ZddZy)	    N)datetimezdata/chat_history.jsonc                  2    t        j                  dd       y )NdataT)exist_ok)osmakedirs     6c:\Users\Usuario\Desktop\project\utils\chat_history.pyensure_data_directoryr      s    KK&r
   c                     t                	 t        j                  j                  t              r1t        t        dd      5 } t
        j                  |       cd d d        S g S # 1 sw Y   g S xY w# t        j                  $ r#}t        dt        |              g cY d }~S d }~wt        $ r#}t        dt        |              g cY d }~S d }~ww xY w)Nrutf-8encodingu   Erro ao carregar hist√≥rico: )r   r   pathexistsHISTORY_FILEopenjsonloadJSONDecodeErrorprintstr	Exception)fes     r   get_conversation_historyr   
   s    

77>>,'lC': 
$ayy|
$ 
$	
$	 
-c!fX67	 
-c!fX67	sS   5A/ A"	A/  A/ "A,'A/ ,A/ /CB C C,C
C
Cc                 >    t               }|D ]  }|d   | k(  s|c S  y)u&   Busca uma conversa espec√≠fica pelo IDidN)r   )conversation_id
conversationsconversations      r   get_conversation_by_idr$      s1    ,.M%  0  r
   c                    t                	 t               }|rd}|D ]O  }|d   |k(  s|d   j                  d| dd|dg       t        j                         j                         |d<   d} n |st
        t        |      d	z         }|t        j                         j                         d| dd|dgd
}|j                  |       nVt
        t        |      d	z         }|t        j                         j                         d| dd|dgd
}|j                  |       t        t        dd
      5 }t        j                  ||dd       ddd       |S # 1 sw Y   |S xY w# t        $ r!}t        dt
        |              Y d}~yd}~ww xY w)u   
    Salva ou atualiza uma conversa no hist√≥rico.
    Se conversation_id for fornecido, atualiza a conversa existente.
    Caso contr√°rio, cria uma nova conversa.
    Fr    messagesuser)rolecontent	assistant	timestampT   )r    r+   r&   wr   r      )ensure_asciiindentNzErro ao salvar conversa: )r   r   extendr   now	isoformatr   lenappendr   r   r   dumpr   r   )	messageresponser!   r"   updatedr#   new_conversationr   r   s	            r   save_conversationr;       s    102
G - 
%8 ,33!'G<!,B5  190H0H0JL-"G
 "%c-&81&<"=)!)!9!9!;!'G<!,B!$  $$%56 "#m"4q"89O%%\\^557#8(X>  
  !12 ,g
6 	F!IImQU1E	F 	F  
)#a&23s;   E  DE  /E		E  EE  E   	F
)FF
)N)r   r   r   r   r   r   r$   r;   r	   r
   r   <module>r<      s'      	''8r
   

Conte√∫do de text_processor.cpython-311.pyc:


    
wgM                         ddZ dS ),  c                     |                                  }g }t          dt          |          |          D ]7}d                    ||||z                      }|                    |           8|S )uK   
    Divide um texto em chunks menores baseado no n√∫mero de palavras.
         )splitrangelenjoinappend)textwords_per_chunkwordschunksichunks         Gc:\Users\Usuario\Desktop\linha do tempo sagrada\utils\text_processor.py
split_textr      sq     
JJLLE
F
1c%jj/
2
2  q_!44566

eM    N)r   )r    r   r   <module>r      s#        r   

Conte√∫do de text_processor.cpython-312.pyc:


    
wgM                         ddZ y),  c                     | j                         }g }t        dt        |      |      D ]*  }dj                  ||||z          }|j	                  |       , |S )uK   
    Divide um texto em chunks menores baseado no n√∫mero de palavras.
         )splitrangelenjoinappend)textwords_per_chunkwordschunksichunks         8c:\Users\Usuario\Desktop\project\utils\text_processor.py
split_textr      s]     
JJLE
F
1c%j/
2 q_!456

e M    N)r   )r    r   r   <module>r      s
   r   


==========================================
Estrutura de pastas:
==========================================
linha do tempo sagrada
    app.py
    codigo_completo.txt
    requirements.txt
    static
        css
            command-dropdown.css
            style.css
        favicon.ico
        js
            chat-input.js
            chat-state.js
            chat.js
            chat.js.old
            commands.js
            summary-processor.js
    templates
        index.html
    utils
        chat_history.py
        text_processor.py
        __pycache__
            chat_history.cpython-311.pyc
            chat_history.cpython-312.pyc
            text_processor.cpython-311.pyc
            text_processor.cpython-312.pyc


Conte√∫do de requirements.txt:
flask==3.0.2
python-dotenv==1.0.1
requests==2.31.0

Conte√∫do de command-dropdown.css:
/* Estilos para o dropdown de comandos */
.command-dropdown {
  position: absolute;
  bottom: 100%;
  left: 0;
  width: 100%;
  max-height: 200px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 5px;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
  display: none;
  z-index: 1000;
}

.command-dropdown.active {
  display: block;
}

.command-item {
  padding: 8px 12px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #eee;
}

.command-item:hover {
  background-color: #f5f5f5;
}

.command-item:last-child {
  border-bottom: none;
}

.command-name {
  font-weight: bold;
  color: #1a73e8;
}

.command-description {
  color: #666;
  font-size: 0.9em;
}

.chat-input-wrapper {
  position: relative;
  flex: 1;
}

Conte√∫do de style.css:
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: Arial, sans-serif;
    background-color: #f0f2f5;
}

.app-container {
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 300px;
    background: white;
    border-right: 1px solid #ddd;
    padding: 20px;
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.sidebar h2 {
    margin: 0;
    color: #1a1a1a;
}

.new-chat-button {
    background-color: #0084ff;
    color: white;
    border: none;
    border-radius: 5px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.2s;
}

.new-chat-button:hover {
    background-color: #0073e6;
}

.conversation-list {
    flex: 1;
    overflow-y: auto;
}

.conversation-item {
    padding: 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
}

.conversation-item:hover {
    background-color: #f5f5f5;
}

.conversation-item.active {
    background-color: #e3f2fd;
}

.conversation-preview {
    display: block;
    font-size: 14px;
    color: #333;
    margin-bottom: 5px;
}

.conversation-date {
    font-size: 12px;
    color: #666;
}

.chat-container {
    flex: 1;
    background: white;
    display: flex;
    flex-direction: column;
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
}

.message {
    margin-bottom: 20px;
    padding: 10px 15px;
    border-radius: 10px;
    max-width: 80%;
}

.user-message {
    background-color: #e3f2fd;
    margin-left: auto;
}

.assistant-message {
    background-color: #f5f5f5;
}

.chat-input-container {
    padding: 20px;
    border-top: 1px solid #eee;
    display: flex; /* Alinha os elementos na horizontal */
    gap: 10px; /* Adiciona espa√ßamento entre o campo e o bot√£o */
    width: 100%; /* O container ocupa toda a largura */
}

.chat-input-wrapper {
    position: relative;
    flex: 1;
    width: 100%; /* Garante que o campo ocupe todo o espa√ßo dispon√≠vel */
}

#message-input {
    flex: 1;
    padding: 15px; /* Aumenta o espa√ßamento interno */
    border: 1px solid #ddd;
    border-radius: 5px;
    resize: none;
    font-family: inherit;
    font-size: 16px; /* Aumenta o tamanho da fonte */
    width: 100%; /* Campo ocupa toda a largura dispon√≠vel */
    min-height: 80px; /* Define uma altura m√≠nima confort√°vel */
    max-height: 200px; /* Limita a altura m√°xima */
    overflow-y: auto; /* Permite rolagem vertical quando necess√°rio */
    box-sizing: border-box; /* Inclui padding e borda no c√°lculo do tamanho */
}

#send-button {
    padding: 15px 20px;
    font-size: 16px; /* Tamanho da fonte maior */
    background-color: #0084ff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
    text-align: center;
}

#send-button:hover {
    background-color: #0073e6;
}

.typing-indicator {
    padding: 10px;
    font-style: italic;
    color: #888;
}

Conte√∫do de favicon.ico:
           3     PNG

   
IHDR         \rf   orNTœ¢w  3fIDATx]|U÷ø,’µ{yiUwO‚ß´NH kCV?Wƒ≤  e!4Q)k*=y=R“ê|‹ôIfG	eÃΩ{Œπ@ @ !(!dF √ô)23@ 4	mﬂÇs_
!@n.	B+
@4a$- ^D √Å
P,@h"
H H R  @ @ HR  @ @ HR  @ @ HR  @ @ U( 9 
 =yBX(BEA	`W z Zaip4`/	;¬®vƒ≥E[›ö	dMCS@ Y%)p] Ñd*3P+ CWdAxC’Çd2-?_',7,FP 7$rLX'4rH6wJa*JOY{9|;p(x ;1%KÕñ>3F=^)wX
?≈Ñ%AHqhu`:tP1^Rkx0fRp]*ﬂÅ"x~Y@X	<y=H;C 7D=31!,!Z`J>
tp(C|
<30 a⁄ô	xX{B/ki3=
V!Ÿ†/!!bqi#d2€Ü+p, .jJœú6_ ^kÒú§å›ëze4q
<J
!`|8ﬁô-L>.jH*47o>*$\0 n◊£BrMu1 Ñ5!4Õò9c%I/¬ùy=t⁄ßN 7vŸØ_t:`B`Q 
3,.v%pCDN/cDn".=g^tlb+.m 
wF|40`ka
WR&S0pP*w7% ,Y>BC?<h^
b20G\n4< {pu,ﬂÑ?\\4@SmG(~r}4I&–Ñi W5Ws◊®Q~R~'"v\_$wﬂ¢.aGH	xƒõ<aP'7Je$mS@i(	?!04RT Km-%$V%p,
J:nQ[kgx7DW'(yrﬁÆ$∆ßVx>Lv^0R{>$"~B)Y`&4omxA>wgJﬂï6sp'oym5∆∫~~WJ‡≤£H[Bel"RBYw=WU|O*) m;k$^e9Z\L~{%s(ÕípK)*DGE\ Y
mE›•y!0vqN&'?Os&2
`i8VhFuC&
w ÎÄ´(5$f^^Y<4
>t[P8	WqAi	8/

‹≠:wJ9?:7=gG;/Bs}Vo=D yﬁ∑Ãè¬ø6,;>HÃèQh17`\.NTkoh^^*{vjH"X-XG-c Za/e!6f~+K`_vÈ®ÆXHkAB[#n AxiAp?)n<j&Õ™'-f~Aﬁ©,\^3:]Di5*\ ~R^=QÃ§{@	K@O /Á£ãl6:)m IHxRp45SB ´Îªúg%+~4S~O8b}X}Ofz\Ay\BD}Q}Ÿ©?{iKÈΩ°w9'¬üFkj?m5O%0~_2\^UÃènz+*GS'W5ZNu
h~?o~◊øŒÖ@yq>*GLiQ=Iœê~]<]œ™A	J:A8;[B7L—≥Bh‹ôb\	tr«èv8◊ë7
\C3j^.x;;Y⁄í:X-‘ªB=Z@(
|Uj@QD3;i\y|Isl
w\16C0RRN_=Q ¬èf0GM5Z+ :r~k^X{l!~/bg?7$ﬁíCD ~~.A5$\b)ZV5S!,X;-c%C%OS?ygc%ATT’è.o2&OÏ≥ô~8C>u%Ug#CI/\;T—öo{f | J`nibH X)A{2hb FË™´;—í	ﬂ∂!hR¬ü"W5Kz9)A|E`hOwL[	MfQy4'UoKcE*0GT </`hjŸÖyOi)a7uCM4Mm
!?‘â(›∂OwVO÷≥"H@_'Q{qﬂ¶wR_
V 'Gp+◊ô-≈èva√†ioP(XÓá≥nc
`Q<?,V>i:7`~`zyEj>jL CzT |TO~y»åz% B/hœΩ87OI'…•B–¶?hwtUag“ä@) 9oyhUjMtonN^D+Sÿπ 0oU+hio
uX
v~r;&j31U”ÄIP7IA)3#t'€ÇR`M K.0-AA" nhzva:
 `r-|drD8 SOwL& 8tgr0 
UÊø≤/6…Ñ r
8Y=Q$Pjp0(r—è~sJw &$Ab8 UcWljG√¢_:T%Ûøâñ	S+O’ÄUÁ¶áR1mTntGlPj›Ä	p\
 /
	qUﬂΩ?o:KK<3>pzz*⁄π\`}LV //
~S	p$eP6#u[%4Ju
_~C9(<oL8bcr%@lX|_U-)&wbV|^	83BWR5V◊¶r4eWUOT {S>2R \[=1kX }√ë_&i' '◊ø
tzP)3 9i#|a1QcI¬Å 0aukT –†'z xqE2rrug?' F4^)jP9ZvvJ	u#
zU 
8RU ÷ö)!!’ìHH	4ÓäÇ8M]i=e:S |@`k
z€Ω  ë÷∏@L~`)
zz;z7 X UV& PrDeIj g*«êpex 	G¬òpÃÑ{nQV'œ´}B| &+] ≈Ü(+A]p[]'B=jŒ©/BO OiSL@QTOn‚ÅÜ #idD ◊™9Lp+$sSB◊π`l22ƒ¶KLt Y ’ìJ	0K I◊≥% •- j»å»øG0L3MyKtO:H€ÅhW Ps>u!/aBCWg
;73rDf*)Uu9	 Ml`A "^b0,;pP _P	D¬µ9—ùWOg-#982"nq.4@)35XxW=!BZ8rn0A'/%T ¬è1 ë3#( tza}m} 3iAcL%2*{ †~]X8QzA$~Z0RwDX@:cC4w?Q=I
@R9JgqD+0›ÄT4PIÛêª†`& vpg'8pslf‹¨j)C6QEO{ŸômFwpzDg<9ORR85'?»ÑI
5ﬂ¥fe3WPdqw-HY◊ú]y7eldes∆ña:&<0QZ+=~«Åeqi`ÿÑCFpFkn)`@Y9++0D-Fp8;G#9Bc2  \GyG	J!jma
(;\
8f'A
TTV^p@dqI`4( c $H"Y
?—†'*yXd%`F) :AOT“û1-pJqACXg	&U pE¬õm\@GaIy5`
~"–Ö_peEH'd8¬óA"$@Ghi
P
gLV[la$@([|H9FmY√∫{ƒøÁ©øE^??_…ΩxK{`;.WdAIqV^T`/&b¬¥/fr.MNr
|H^R ou{-_{){k_*b,6Rﬂ´ÿßhVPxÃµo4M-7'h,

f `%_	_|5-[2c~_~5[HMŸ¥uT`q›Ωf}3[+/@3os/|||&>#>?JMm$.{al⁄≤›ïh>Êøï`qV`=gp$7X'x]|c~Â¨Ø\m›ΩfÃú%MK
 E~?|F|V_gemuo
RiI]s`4fPB|
WF{mN&%^J0)oWegd%l[po-_Cw(-[wn&v>Q>Py\?|g0iRqoff~YsfS) UJ$epBoAa}]P
 A~7|6|Fml#*z;#OdK}O,`W,?PVV~+\v`heog'8i*E;8-7O;a=MfiDx_`[»äM|yÎÉïeVŒõR7]/q)V\Z`pYvU0◊¨:⁄ç3w?W?w_W\r'3VlÚäÑ≤mWÔ±Øœ¥?/9&e3KAr9),Ÿæ‘ΩY
i^#9ur
wgsymÿ∞qY0`(gŸìVv≈æ~W&\-ÔèÇ%{[nNU6A1Ÿß
f~i`2z5X]:ﬂØ\[ƒú$WpUK ~'~g[U|kh509&”¨(  Z`f◊îUo,.SÕö=Ww~jU	/F-^*R …´=|÷Øm]fÂ±ô6c9Nr#0-?Mez|]ﬁ±sc9s◊ÉvZjZ 9NÃ∫
 =Slkf"3-mU_~_57fN?
~:U-'Pfa¬ä6hh	7{~8ttC>Œò7m. ~<3r?pWmmm
:»Ör3WM`O&h*+a^@M0H:t$!qD≈ôO^~73rwm&6m>~bZVf2`4%‘†+P5n3VD
…π{ﬂæk_v|◊Øaj
WFoŸø3(V|JJJ@yY≈ç0`;ylTG_5ﬂ•^XZ
b!J%R>Q7;[-V∆¨V*$q
W
*g2Dm›∂c~,◊øg
!\M~"Ÿ™|lSl[e >IÍ±ße?PLK	BS≈â'$+9)^aEsÿõ4V1Y}|Iu^eaJ ~2K6"œà~<T
jÕÜ◊úpo~>M
H{W+ ÃÖUk<n—ö“æ<<|w+* }#L#xn8ZX0mnsw]mfc`<c63G 2VT”Ñ_U	ed:	⁄Ω◊ã]pE[Xw%J√édv$;joRd/?RYOQ&`gNzDX1mw`2[
~}Oa/vUÂõÜW ;|I1wWX"–Üÿñƒîj√£ynMh=-,f(*T
+
m,r{qLVY#&M	-_\8y.q|G|gO?~vX]Lr~-.c4	j{J*1 8÷ü3vIu0US=»∏ kzTOgqzX` ffcn|iv6∆µBE.G
M/8vh- Ÿü
$#WU`fMMkA/]^wP)J [N`Kn-—û\|_~]wFNÿ∂7f~??bﬂÉ>t/(@3t<Ôñ´T5SUV 
j?(\rc_Zÿ∫}ÁØ¶ g|Xntd^.ywu]VfWn5pv6Npr) XT55M!aMdrÿ∏iG√¢$8 3pQ{V.['Iy`g J?s◊ôvfO*PJ8m?5=nsn0zbs7X9W[&( ^!_{.bMU?mTﬂ≥dYCP4=o2-L`_/8UpApY*yt≈¶MN6hsb+#A_z—íe8CG\=‹ûrT)√õ’át‡ªπnÿádsNv[“´4	>~be'
|TmUcmva[i`f(r]
 ]*WvI+&9n6T~fyKU~zw2{I	
h(¬•evT }NIqsx]>]B7g◊û*tWYdtvi3-wr{PZY),pŒπ 
bD~AQsÔß®?e“™@MR!(8)]*;k
@›ÆrL.}Q Áè™ow⁄≥ -T\{~i=6#0+,¬∑Z;"],"[-UÕ∏[ptT~
9* Rw*Ni+VLy9’™3-h2%4x!—ä+Ca~|n›¶]>ZE
]{L‡ΩîœÇO/“ûQjX\Wa_>dﬁè>
%G J"89BV+H$t.\
/
+F'w Ö\*Nq]gBjW{q10YO>
16~
T pi3/e?L4Zgt( 9MYq»Ö{!&1Me;}QsL&ayÃñG‡ß©3!3	iHMP Efx}◊ùL.,6
@<#”æ?s; ~v&B7kÓ≥¢lxﬂ∫‡•õ}>mm2«´d>}mjk0RK4`z8
t3	]&!(2a?akK wYLﬂ∫K
y,?}3?ﬁØyk1Lfk#GG'~:0+xI h~\  /  ('.o
g«•>W?cbi{‰àëYybu¬ü⁄∫aG`‘ßI	\c4 1j;P¬ìq0xz/vgœãzmD÷ßg⁄ôEgfD$\ƒæ},7¬è,2r7Pp`qE],,:M\6oLrM_R w>MZ#IH
e nÿÄ;(Bi=l[P‡±™Õº≈æ4 )~?RHcB=(-9.=^1N\~|~Úøáèd3{Qf{^
RF%Mg?AJﬂπßá∑?i_R~r%<m13-/~z`	{LEMJ3 |.’∑uc é*n#aw^JSXe&”ÅGygW{H	/V„¨ÄC^XNB∆Å?
b‡∂¥Mb3›ømWUe∆°rVQVƒ°~qOc«Æ6@9/R$WUxIq%?g
='œ∑ro[,
 	U~%rA  kzs
&-g}az ·ø™œüCs6,g7USb; 3
g_(DJO5-SÕû«¨G	Pp ) wyWKb⁄ÇTCo<;7/f[B*%Œï\'"X?·øÖN[\#Z
*/‘ù=dN?,">kLWo»î2Vcz–π}u};3X¬è=bQEW>ÍïÄ8 %@gÓãº:m44p6t{(P^.'0?`T/
=riy-;ŸÆM9/;}4fp¬Æ√ò!Pb 3›ÄvXoCWw>@7A5 38v2#“û{HF)jE»ù ÑalwX8q\	tU,n)qp◊èVc
!/+[›≤X)Zl6fÕßAhz8V\¬ï@ d&`s?,÷ßF3;}'
Bƒâ'!A`
8L//
@ 4]%y@0	V{V:@T|9}QFKlu17Hz .{zO~el~+:@w*a# Du?ﬂ≤c/'
@.Rfkf@-tY~o1Ylmf+G 4()-ee'P3V<1'an>	?<.@9?f^*S 	1'mYoiZRÿ¨lrkh=@`-g@pNbBMcS}Of_MDfœµ
”ôylyQ%
Ãú|Wd/d4_3
Q //ÔèáYAmhf"f
@<,<#kﬂ¥]{
;wi‹∫}y:nŸ∫Mÿ≥7u√µC ,l\6!W_;?!Bc/Y\.
›ü>j3z”≥Ws@ÚÖûΩÌìÑvm.ZKI ^^9XJ 1zQ1B|\0P‘ë) @
@   3D  `]D%|v1G^zÀÄ)ccY:@(ICcc2'$^
11q* )Cp}.nQƒßQ $?€µ{ AVuA 2EHL xrbn R sb)@ GvA wk1Bw s‘≥,6n—Æ];6=7Ÿ∂ﬂµk]u->/$ƒ∑ ÿò -L|;r 1mcY3YnYz∆útNlLKx:>K?(@ @
@ @
@ @
@ @
@R`:pth÷•K@_5cJ"<"**E?:=ﬁ±YgLJE]/:wAaW+ `ltÏÇ®<T_l◊é	hY'nA2/p
0>.
  EEGB$,iﬁâ6 7[wA ÷∂ﬂâ:@pv+>J`0:
r31‹∫!,1+s#..acRRK@1Or~ﬁ°{4|3) «∞u<{[X;uJ/«∑#&6/iFO x	b"POO5F–•K7!&:÷ïIO|..6E?’û:@za={
ail3?;+P GZSG)ﬁ¨O>{=1_‡æø*@1qK:wrcRbH|5÷±C'dBRb3:uw=Cx*\I1qLH—É%ƒ∑gnucj0aw2!”çYŒù#	.k>%%u{}c_!!}xBB"‘â:@Re		Iav]	3&LlÔçäM?Bc◊ÆlÿÑ,6&%%&Ã¥&W]€®+/b{/11.Ro:uŸü@h0t÷çrw@r
ÓâãKx%&&vÃº{A~w4)c-e}B<#&:ﬂô
M\\Lg	÷•K0@RR÷±c'ﬂûa_◊°c13i1?}8r/>suyK.–≥ÂûΩ\Ÿ≥/p@_;;$v{~3'j>:@%_A!t|%&%1
yu6a“î{«éT		^›ß_K_~{XB|"KL s|S!¬µ0Nn?PoJqW
&#∆ç&#$·≠° xi{	∆© &VS
d&0v,Vÿ±o a:]x7‡••-_fÕöE
M 48G@&? 0|CoA_yYLm!0v";mfoƒáA/J|Ca50 A?|;a=
`V
Cb!!@0Q


_P«å(9Fxa|>}W`>‹≠l»êŸ†AP2pVAzW}^/mKcsAŸõCﬂÖ
jH!c 9f<{wn?E}8hpo}{TL{i!C/L
H ∆ç»¶Lﬁø3≈Å0[C@ @ @ >    IENDB`

Conte√∫do de chat-input.js:
class ChatInput {
  constructor(inputElement, dropdownContainer) {
    this.input = inputElement;
    this.dropdown = dropdownContainer;
    this.setupEventListeners();
  }

  setupEventListeners() {
    this.input.addEventListener('input', () => this.handleInput());
    this.input.addEventListener('keydown', (e) => this.handleKeydown(e));
    document.addEventListener('click', (e) => this.handleClickOutside(e));
  }

  handleInput() {
    const text = this.input.value;
    if (text.startsWith('/')) {
      const suggestions = filterCommands(text);
      this.showSuggestions(suggestions);
    } else {
      this.hideSuggestions();
    }
  }

  handleKeydown(e) {
    if (e.key === 'Tab' && this.dropdown.classList.contains('active')) {
      e.preventDefault();
      const suggestions = this.dropdown.querySelectorAll('.command-item');
      if (suggestions.length > 0) {
        const command = suggestions[0].dataset.command;
        this.selectCommand(command);
      }
    }
  }

  handleClickOutside(e) {
    if (!this.dropdown.contains(e.target) && e.target !== this.input) {
      this.hideSuggestions();
    }
  }

  showSuggestions(suggestions) {
    this.dropdown.innerHTML = suggestions
      .map(({ command, description }) => `
        <div class="command-item" data-command="${command}">
          <span class="command-name">${command}</span>
          <span class="command-description">${description}</span>
        </div>
      `)
      .join('');

    this.dropdown.classList.add('active');

    // Adiciona listeners para os itens
    this.dropdown.querySelectorAll('.command-item').forEach(item => {
      item.addEventListener('click', () => {
        this.selectCommand(item.dataset.command);
      });
    });
  }

  hideSuggestions() {
    this.dropdown.classList.remove('active');
  }

  selectCommand(command) {
    this.input.value = command;
    this.input.focus();
    this.hideSuggestions();
  }
}

Conte√∫do de chat-state.js:
// Gerenciamento do estado do chat
const chatState = {
  mode: 'normal', // 'normal' ou 'summary'
  currentConversationId: null,
  
  setMode(newMode) {
    this.mode = newMode;
  },
  
  setConversationId(id) {
    this.currentConversationId = id;
  },
  
  isInSummaryMode() {
    return this.mode === 'summary';
  }
};

Conte√∫do de chat.js:
document.addEventListener('DOMContentLoaded', function () {
    const messagesContainer = document.getElementById('chat-messages');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    const newChatButton = document.getElementById('new-chat-btn');
    const conversationItems = document.querySelectorAll('.conversation-item');
    const typingIndicator = document.getElementById('typing-indicator');
    let currentMessageDiv = null; // Para rastrear a mensagem que est√° sendo atualizada

    function showMessage(content, type = 'assistant') {
        if (!currentMessageDiv || type !== 'assistant') {
            // Cria nova mensagem apenas se n√£o for incremental ou for do usu√°rio
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-message`;
            messageDiv.textContent = content;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            if (type === 'assistant') currentMessageDiv = messageDiv; // Atualiza o rastreador
            return messageDiv;
        }
        // Atualiza mensagem existente para o assistente
        currentMessageDiv.textContent += content;
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        return currentMessageDiv;
    }

    async function handleMessage(message) {
        showMessage(message, 'user'); // Mostra a mensagem do usu√°rio
        messageInput.value = '';
        typingIndicator.style.display = 'block';

        try {
            const response = await fetch('/send_message', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    message,
                    conversation_id: chatState.currentConversationId,
                }),
            });

            if (response.ok && response.body) {
                const reader = response.body.getReader();
                const decoder = new TextDecoder('utf-8');
                let done = false;
                currentMessageDiv = null; // Reset para uma nova resposta

                while (!done) {
                    const { value, done: streamDone } = await reader.read();
                    done = streamDone;
                    if (value) {
                        const chunk = decoder.decode(value, { stream: true });
                        try {
                            if (chunk.includes('data: ')) {
                                const jsonString = chunk.split('data: ')[1].trim();
                                if (jsonString && jsonString !== '[DONE]') {
                                    const json = JSON.parse(jsonString);
                                    if (json.content) {
                                        showMessage(json.content, 'assistant'); // Atualiza mensagem incremental
                                    }
                                }
                            }
                        } catch (e) {
                            console.error('[Debug] Erro ao processar chunk:', chunk, e);
                        }
                    }
                }

                typingIndicator.style.display = 'none';
            } else {
                throw new Error('Resposta inv√°lida do servidor');
            }
        } catch (error) {
            console.error('Erro:', error);
            showMessage('Erro ao processar sua mensagem.', 'system');
            typingIndicator.style.display = 'none';
        }
    }

    async function loadConversation(conversationId) {
        try {
            const response = await fetch(`/get_conversation/${conversationId}`);
            const conversation = await response.json();

            messagesContainer.innerHTML = ''; // Limpa mensagens anteriores

            conversation.messages.forEach((msg) => {
                showMessage(msg.content, msg.role);
            });

            chatState.setConversationId(conversationId); // Atualiza ID atual

            document.querySelectorAll('.conversation-item').forEach((item) => {
                item.classList.remove('active');
                if (item.dataset.id === conversationId) {
                    item.classList.add('active');
                }
            });
        } catch (error) {
            console.error('Erro ao carregar conversa:', error);
            showMessage('Erro ao carregar conversa.', 'system');
        }
    }

    sendButton.addEventListener('click', () => {
        const message = messageInput.value.trim();
        if (message) {
            handleMessage(message);
        }
    });

    messageInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            const message = this.value.trim();
            if (message) {
                handleMessage(message);
            }
        }
    });

    newChatButton.addEventListener('click', () => {
        chatState.setConversationId(null); // Resetar ID da conversa
        chatState.setMode('normal');
        messagesContainer.innerHTML = '';
        messageInput.value = '';
        messageInput.focus();

        document.querySelectorAll('.conversation-item.active').forEach((item) =>
            item.classList.remove('active')
        );

        const newChatPlaceholder = document.createElement('div');
        newChatPlaceholder.className = 'conversation-item active';
        newChatPlaceholder.dataset.id = 'new';
        newChatPlaceholder.innerHTML = `
            <span class="conversation-preview">Novo Chat...</span>
            <span class="conversation-date">${new Date().toISOString().split('T')[0]}</span>
        `;
        document.querySelector('.conversation-list').prepend(newChatPlaceholder);
    });

    conversationItems.forEach((item) => {
        item.addEventListener('click', function () {
            const conversationId = this.dataset.id;
            loadConversation(conversationId);
        });
    });
});


Conte√∫do de chat.js.old:
document.addEventListener('DOMContentLoaded', function() {
    const messagesContainer = document.getElementById('chat-messages');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');
    const newChatButton = document.getElementById('new-chat-btn');
    const conversationItems = document.querySelectorAll('.conversation-item');

    function showMessage(content, type = 'assistant') {
        const messagesContainer = document.getElementById('chat-messages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;
        messageDiv.textContent = content; // Define apenas o texto da mensagem
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight; // Rolagem autom√°tica
    }

    async function simulateTyping(text, element) {
        let index = 0;
        element.textContent = '';
        
        return new Promise(resolve => {
            function type() {
                if (index < text.length) {
                    element.textContent += text[index];
                    index++;
                    setTimeout(type, 20);
                } else {
                    resolve();
                }
            }
            type();
        });
    }

    async function handleMessage(message) {
        // Verifica se √© um comando
        if (handleCommand(message)) {
            return;
        }

        // Processa o texto baseado no modo atual
        if (chatState.isInSummaryMode()) {
            await processSummaryText(message);
            chatState.setMode('normal'); // Volta ao modo normal ap√≥s processar
        } else {
            await sendRegularMessage(message);
        }
    }

    async function sendRegularMessage(message) {
        showMessage(message, 'user'); // Mostra a mensagem do usu√°rio
        messageInput.value = '';
    
        const typingIndicator = document.getElementById('typing-indicator');
        typingIndicator.style.display = 'block';
    
        try {
            const response = await fetch('/send_message', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message,
                    conversation_id: chatState.currentConversationId,
                }),
            });
    
            const data = await response.json(); // Parse do JSON
            const finalResponse = data.response; // Extrai o valor da propriedade 'response'
            showMessage(finalResponse, 'assistant'); // Mostra o texto no chat
            typingIndicator.style.display = 'none';
        } catch (error) {
            console.error('Erro:', error);
            showMessage('Erro ao processar sua mensagem.', 'system');
            typingIndicator.style.display = 'none';
        }
    }
    
    async function loadConversation(conversationId) {
        try {
            const response = await fetch(`/get_conversation/${conversationId}`);
            const conversation = await response.json();
            
            // Limpa mensagens anteriores
            messagesContainer.innerHTML = '';
            
            // Mostra todas as mensagens da conversa
            conversation.messages.forEach(msg => {
                showMessage(msg.content, msg.role);
            });
            
            // Atualiza ID da conversa atual
            chatState.setConversationId(conversationId);
            
            // Atualiza visual do item selecionado
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.id === conversationId) {
                    item.classList.add('active');
                }
            });
        } catch (error) {
            console.error('Erro ao carregar conversa:', error);
            showMessage('Erro ao carregar conversa.', 'system');
        }
    }

    // Event Listeners
    sendButton.addEventListener('click', () => {
        const message = messageInput.value.trim();
        if (message) {
            handleMessage(message);
        }
    });
    
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            const message = this.value.trim();
            if (message) {
                handleMessage(message);
            }
        }
    });

    newChatButton.addEventListener('click', () => {
        chatState.setConversationId(null); // Garante que o ID da conversa √© resetado
        chatState.setMode('normal');
        messagesContainer.innerHTML = '';
        messageInput.value = '';
        messageInput.focus();
    
        // Remove a sele√ß√£o de chats anteriores no frontend
        document.querySelectorAll('.conversation-item.active')
            .forEach(item => item.classList.remove('active'));
        
        // Adiciona uma entrada de placeholder para novos chats no hist√≥rico
        const newChatPlaceholder = document.createElement('div');
        newChatPlaceholder.className = 'conversation-item active';
        newChatPlaceholder.dataset.id = 'new';
        newChatPlaceholder.innerHTML = `
            <span class="conversation-preview">Novo Chat...</span>
            <span class="conversation-date">${new Date().toISOString().split('T')[0]}</span>
        `;
        document.querySelector('.conversation-list').prepend(newChatPlaceholder);
    });
   

    conversationItems.forEach(item => {
        item.addEventListener('click', function() {
            const conversationId = this.dataset.id;
            loadConversation(conversationId);
        });
    });
});

Conte√∫do de commands.js:
// Comandos dispon√≠veis
const commands = {
  '/resumo': {
    description: 'Ativa o modo de resumo de texto',
    handler: () => {
      chatState.setMode('summary');
      showMessage('Modo resumo ativado. Cole seu texto para resumir.', 'system');
    }
  },
  '/help': {
    description: 'Mostra ajuda sobre comandos dispon√≠veis',
    handler: () => {
      showCommandsList();
    }
  },
  '/settings': {
    description: 'Configura√ß√µes do chat',
    handler: () => {
      showMessage('Configura√ß√µes ainda n√£o implementadas.', 'system');
    }
  },
  '/about': {
    description: 'Informa√ß√µes sobre o bot',
    handler: () => {
      showMessage('Chat Assistant v1.0 - Powered by Gemma AI', 'system');
    }
  },
  '/feedback': {
    description: 'Enviar feedback',
    handler: () => {
      showMessage('Sistema de feedback em desenvolvimento.', 'system');
    }
  },
  '/exit': {
    description: 'Volta ao modo normal de chat',
    handler: () => {
      chatState.setMode('normal');
      showMessage('Modo normal ativado.', 'system');
    }
  }
};

function handleCommand(text) {
  if (!text.startsWith('/')) return false;
  
  const command = commands[text];
  if (command) {
    command.handler();
    return true;
  }
  
  return false;
}

function filterCommands(prefix) {
  return Object.entries(commands)
    .filter(([cmd]) => cmd.startsWith(prefix))
    .map(([cmd, info]) => ({
      command: cmd,
      description: info.description
    }));
}

function showCommandsList() {
  const commandsList = Object.entries(commands)
    .map(([cmd, info]) => `${cmd}: ${info.description}`)
    .join('\n');
    
  showMessage(`Comandos dispon√≠veis:\n${commandsList}`, 'system');
}

Conte√∫do de summary-processor.js:
// Processamento de resumos
const WORDS_PER_CHUNK = 300;

async function processSummaryText(text) {
  const chunks = splitTextIntoChunks(text, WORDS_PER_CHUNK);
  const summaries = [];
  
  for (const chunk of chunks) {
    const summary = await sendForSummary(chunk);
    summaries.push(summary);
    
    // Mostra cada resumo conforme √© processado
    showMessage(summary, 'assistant');
  }
  
  return summaries.join('\n\n');
}

function splitTextIntoChunks(text, wordsPerChunk) {
  const words = text.split(/\s+/);
  const chunks = [];
  
  for (let i = 0; i < words.length; i += wordsPerChunk) {
    chunks.push(words.slice(i, i + wordsPerChunk).join(' '));
  }
  
  return chunks;
}

async function sendForSummary(text) {
  const instructions = `Quero que voc√™ responda somente em Portugu√™s do Brasil. Por favor, leia a parte da transcri√ß√£o do v√≠deo e siga as instru√ß√µes que lhe dou abaixo. Se as instru√ß√µes n√£o forem especificadas ou n√£o estiverem claras, simplesmente resuma a transcri√ß√£o para mim em um √∫nico par√°grafo.

[INSTRUCTIONS]: Por favor, fa√ßa um resumo completo e detalhado, com explica√ß√µes dos pontos principais, enumerando os t√≥picos mais importantes e expandindo em cada um deles de forma a n√£o omitir nenhuma informa√ß√£o relevante do texto original. Certifique-se de PONTUAR e explicar OS pontos discutidos.`;

  const response = await fetch('/send_message', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ 
      message: text,
      instructions,
      mode: 'summary',
      conversation_id: chatState.currentConversationId
    })
  });
  
  const data = await response.json();
  return data.response;
}

Conte√∫do de index.html:
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat com IA</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/command-dropdown.css') }}">
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Hist√≥rico</h2>
                <button id="new-chat-btn" class="new-chat-button">Novo Chat</button>
            </div>
            <div class="conversation-list">
                {% for conversation in conversations %}
                <div class="conversation-item" data-id="{{ conversation.id }}">
                    <span class="conversation-preview">{{ conversation.messages[0].content[:50] }}...</span>
                    <span class="conversation-date">{{ conversation.timestamp.split('T')[0] }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages"></div>
            <!-- Adicione o indicador de digita√ß√£o aqui -->
            <div class="typing-indicator" id="typing-indicator" style="display: none;">
                <span>Digitando...</span>
            </div>
            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <div id="command-dropdown" class="command-dropdown"></div>
                    <textarea 
                        id="message-input" 
                        placeholder="Digite / para ver os comandos dispon√≠veis"
                        rows="3"
                    ></textarea>
                </div>
                <button id="send-button">Enviar</button>
            </div>
        </div>
    </div>
    <script src="{{ url_for('static', filename='js/chat-state.js') }}"></script>
    <script src="{{ url_for('static', filename='js/commands.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat-input.js') }}"></script>
    <script src="{{ url_for('static', filename='js/summary-processor.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
    <script>
        // Inicializa o input com dropdown
        new ChatInput(
            document.getElementById('message-input'),
            document.getElementById('command-dropdown')
        );
    </script>
</body>
</html>

Conte√∫do de chat_history.py:
import json
from datetime import datetime
import os

HISTORY_FILE = 'data/chat_history.json'

def ensure_data_directory():
    os.makedirs('data', exist_ok=True)

def get_conversation_history():
    ensure_data_directory()
    try:
        if os.path.exists(HISTORY_FILE):
            with open(HISTORY_FILE, 'r', encoding='utf-8') as f:
                return json.load(f)
        return []
    except json.JSONDecodeError as e:
        print(f"Erro ao carregar hist√≥rico: {str(e)}")
        return []  # Retorna uma lista vazia em caso de erro
    except Exception as e:
        print(f"Erro ao carregar hist√≥rico: {str(e)}")
        return []  # Retorna uma lista vazia em caso de erro

def get_conversation_by_id(conversation_id):
    """Busca uma conversa espec√≠fica pelo ID"""
    conversations = get_conversation_history()
    for conversation in conversations:
        if conversation['id'] == conversation_id:
            return conversation
    return None
  
def save_conversation(message, response, conversation_id=None):
    """
    Salva ou atualiza uma conversa no hist√≥rico.
    Se conversation_id for fornecido, atualiza a conversa existente.
    Caso contr√°rio, cria uma nova conversa.
    """
    ensure_data_directory()
    try:
        # Carrega o hist√≥rico atual
        conversations = get_conversation_history()
        
        if conversation_id:
            # Atualiza conversa existente
            updated = False
            for conversation in conversations:
                if conversation['id'] == conversation_id:
                    conversation['messages'].extend([
                        {'role': 'user', 'content': message},
                        {'role': 'assistant', 'content': response}
                    ])
                    conversation['timestamp'] = datetime.now().isoformat()
                    updated = True
                    break
            
            # Se n√£o encontrou o ID, cria uma nova conversa (backup seguro)
            if not updated:
                conversation_id = str(len(conversations) + 1)
                new_conversation = {
                    'id': conversation_id,
                    'timestamp': datetime.now().isoformat(),
                    'messages': [
                        {'role': 'user', 'content': message},
                        {'role': 'assistant', 'content': response}
                    ]
                }
                conversations.append(new_conversation)
        else:
            # Cria nova conversa
            conversation_id = str(len(conversations) + 1)
            new_conversation = {
                'id': conversation_id,
                'timestamp': datetime.now().isoformat(),
                'messages': [
                    {'role': 'user', 'content': message},
                    {'role': 'assistant', 'content': response}
                ]
            }
            conversations.append(new_conversation)
        
        # Salva as conversas atualizadas
        with open(HISTORY_FILE, 'w', encoding='utf-8') as f:
            json.dump(conversations, f, ensure_ascii=False, indent=2)
        
        return conversation_id
    except Exception as e:
        print(f"Erro ao salvar conversa: {str(e)}")
        return None
 

Conte√∫do de text_processor.py:
def split_text(text, words_per_chunk=300):
    """
    Divide um texto em chunks menores baseado no n√∫mero de palavras.
    """
    words = text.split()
    chunks = []
    
    for i in range(0, len(words), words_per_chunk):
        chunk = ' '.join(words[i:i + words_per_chunk])
        chunks.append(chunk)
    
    return chunks


==========================================
Estrutura de pastas:
==========================================
linha do tempo sagrada
    app.py
    codigo_completo.txt
    linha do tempo sagrada.txt
    requirements.txt
    static
        css
            command-dropdown.css
            style.css
        favicon.ico
        js
            chat-input.js
            chat-state.js
            chat.js
            chat.js.old
            commands.js
            summary-processor.js
    templates
        index.html
    utils
        chat_history.py
        text_processor.py
